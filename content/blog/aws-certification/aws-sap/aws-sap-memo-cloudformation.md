---
title: "AWS-SAP 模試メモ - AWS CloudFormation"
date: 2021-01-24T12:14:47+09:00
draft: false

# post thumb
# image: "images/xxxxx.jpg"

# meta description
description: "AWS-SAP の模擬試験を受けての復習メモ"

# taxonomies
categories:
  - "AWS-SAP"
tags:
  - "AWS"
  - "SAP"
  - "ソリューションアーキテクトプロフェッショナル"
  - "AWS CloudFormation"

# post type
type: "featured"
---

# AWS CloudFront

## パラメータ設定方法
AWS::Lambda::Functionを利用して、Lambda 関数のデプロイパッケージをCloudFormationで参照します。すべてのランタイムに対して、Amazon S3 内のオブジェクトの場所を指定できます。

※Lambda関数コードをコードレポジトリーに保存し、CloudFormationのAWS :: Lambda :: Functionにおいて参照するといった設定方法はありません

また、Node.js および Python 関数の場合で依存関係がない限りテンプレートにインラインで関数コードを指定できます。

## テンプレート管理

## スタックセット
スタックセットでは、1 つの AWS CloudFormation テンプレートを使用して、複数のリージョンの AWS アカウントにスタックを作成できます。各スタックに含まれるリソースはすべて、スタックセットの AWS CloudFormation テンプレートで定義されます。スタックセットを作成する際、使用するテンプレートに加え、そのテンプレートで必要なパラメータや機能を指定します。

#### 全アカウントのテンプレート更新
CloudFormationのスタックセットを使用し、数のAWSアカウントやリージョンを横断したリソース展開が可能です。

CloudFormation テンプレート内に AWS リソースの設定を定義すると、数クリックで複数の AWS アカウントやリージョンにAWSリソースを水平展開できます。クロスアカウントやクロスリージョンのシナリオを解決する AWS 機能のベースラインレベルのセットアップに、この機能を活用できます。一度セットアップしてしまえば、追加のアカウントやリージョンに対しても容易に展開することができます。この機能は、常にクロスアカウントベースで動作します。管理者のアカウントによって、1つ以上のスタックセットが保持されるとともに1つ以上の対象アカウントへのデプロイが制御されます。

#### 変更セット
スタックを更新する必要がある場合は、変更の実装前に実行中のリソースに与える影響を理解することで、安心してスタックを更新できます。変更セットを使用すると、スタックの変更案が実行中のリソースに与える可能性がある影響 (たとえば、変更によって重要なリソースが削除されたり置き換えられたりしないか) を確認できます。変更セットの実行を確定したときのみ AWS CloudFormation によってスタックが変更されるため、変更案のまま続行するか別の変更セットを作成して他の変更を検討するかを決定できます。変更セットは、AWS CloudFormation コンソール、AWS CLI、または AWS CloudFormation API を使用して作成できます。

#### 他リージョンへの展開
各リージョンでは、リージョン内のみで利用可能な異なるAMI IDを有しています。そのため、CloudFormationテンプレートにおけるMappingsとFindInMapを利用して、リージョン毎に適切なAMI IDを選択して構成することが必要です。

各リージョンへの展開を実施するためには、管理者アカウントのすべてのユーザーとグループに、そのアカウントで管理されているすべてのスタックセットを作成および更新するアクセス権限を付与することが必要です。そのためには、管理者とすべてのターゲットアカウントの IAM ロールを作成します。管理者アカウントへのアクセス権限を持つユーザーは、ターゲットアカウントの任意のスタックセットを作成、更新、または削除するアクセス権限を持ちます。

## 各種パラメータ

#### Creation Policy

Amazon EC2およびAuto Scalingリソースの場合、WaitConditionの代わりにCreationPolicy属性を使用することが最適です。CreationPolicy 属性をリソースに関連付けて、AWS CloudFormation が指定数の成功シグナルを受信するかまたはタイムアウト期間が超過するまでは、ステータスが作成完了にならないようにします。スタックの作成に進む前にリソース設定アクションを待機する場合は、CreationPolicy 属性を使用します。たとえば、EC2 インスタンスにソフトウェアアプリケーションをインストールして設定する際に、先に進む前にこのアプリケーションを起動して実行する場合があります。このような場合、インスタンスに CreationPolicy 属性を追加すると、アプリケーションがインストールされ設定された後に、インスタンスに成功シグナルを送信します。

#### WaitCondition

AWS::CloudFormation::WaitConditionを利用して、リソースを待機させることができます。しかし、Amazon EC2 および Auto Scaling リソースについては、WaitConditionではなく CreationPolicy 属性を使用することがAWSで推奨されており、最適な選択ではありません。 

#### !Ref

!Refは組み込み関数を使用し、指定したパラメータまたはリソースに関する情報をリターンします。